<!DOCTYPE html>
<html>

<head>
    <title>The Members - ITKMITL Multimedia Programming 2563</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" type="text/css" href="lab.css">
</head>

<body>
    <div id="app">
        <h2 v-for="p in person">{{p.name}}</h2> <!-- v-for ใช้ในการวน loop ข้อมูลทั้งหมดใน name -->
        <button @click="pullProfile">show</button> <!-- @click (V-on:click) เหมือนกับ onclick กรณีนี้ใช้เรียก methods -->
        <img :src="pic[0].url" alt="loading...">
    </div>

    <script>
        fetch('https://jsonplaceholder.typicode.com/users') //link APIs
            .then(response => response.json())
            .then(json => {
                console.log(json)
                app.person = json //เก็บ APIs ในรูป string ในตัวแปร person
            })

        let app = new Vue({
            el: '#app',
            data: {
                person: [],
                pic: [{url: ''}]
            },
            methods: {
                pullProfile: function () {
                    fetch('https://api.thecatapi.com/v1/images/search')
                        .then(response => response.json())
                        .then(json => {
                            console.log(json)
                            app.pic = json
                            if(this.pic[0].url == null){ //ดัก APIs ที่อาจเกิด error
                                this.pullProfile()
                            }
                        })
                }
            },
            mounted(){
                this.pullProfile() //แสดงผล APIs ทันทีเมื่อมีการเปิด web
            }
        })

    </script>
</body>

</html>